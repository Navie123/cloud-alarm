<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cloud Fire Alarm Dashboard</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff5722">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div id="loginScreen" class="login-screen">
    <div class="login-container">
      <div class="login-logo"><i class="fas fa-fire-flame-curved"></i></div>
      <h1 class="login-title">Sign In</h1>
      <p class="login-subtitle">Access your fire alarm dashboard</p>
      
      <form id="loginForm" onsubmit="loginUser(); return false;">
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="emailInput" placeholder="Enter your email" autocomplete="email" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <div class="input-wrapper">
            <input type="password" id="passwordInput" placeholder="Enter your password" autocomplete="current-password" required>
            <button type="button" class="toggle-password" onclick="togglePassword('passwordInput', this)"><i class="fas fa-eye"></i></button>
          </div>
        </div>
        <button type="submit" class="btn-signin"><i class="fas fa-sign-in-alt"></i> Sign In</button>
        <div id="loginError" class="error-message"></div>
        <div class="divider"><span>or</span></div>
        <button type="button" class="btn-google" onclick="signInWithGoogle()">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          Continue with Google
        </button>
        <p class="auth-switch">Don't have an account? <a href="#" onclick="showRegister(); return false;">Register</a></p>
      </form>
      
      <form id="registerForm" class="hidden" onsubmit="registerUser(); return false;">
        <div class="form-group">
          <label>Name</label>
          <input type="text" id="nameInput" placeholder="Enter your name" autocomplete="name" required>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="regEmailInput" placeholder="Enter your email" autocomplete="email" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <div class="input-wrapper">
            <input type="password" id="regPasswordInput" placeholder="Create a password" autocomplete="new-password" required>
            <button type="button" class="toggle-password" onclick="togglePassword('regPasswordInput', this)"><i class="fas fa-eye"></i></button>
          </div>
          <small class="password-hint">Min 8 chars, 1 uppercase, 1 number</small>
        </div>
        <button type="submit" class="btn-signin"><i class="fas fa-user-plus"></i> Register</button>
        <div id="registerError" class="error-message"></div>
        <div class="divider"><span>or</span></div>
        <button type="button" class="btn-google" onclick="signInWithGoogle()">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          Continue with Google
        </button>
        <p class="auth-switch"><a href="#" onclick="showLogin(); return false;"><i class="fas fa-arrow-left"></i> Back to Sign In</a></p>
      </form>
    </div>
  </div>

  <div id="mainApp" class="main-app" style="display:none;">
    <div class="siren-overlay" id="sirenOverlay"></div>
    <div id="audioPrompt" class="audio-prompt">
      <div class="audio-prompt-content">
        <i class="fas fa-volume-up"></i>
        <h2>Enable Alarm Sound</h2>
        <p>Allow audio to hear alarm alerts</p>
        <button class="btn btn-primary" onclick="enableAudio()"><i class="fas fa-check"></i> Enable Sound</button>
      </div>
    </div>
    
    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>
    
    <!-- Improved Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title"><i class="fas fa-cog"></i> Settings</div>
        <button class="close-btn" onclick="closeSidebar()"><i class="fas fa-times"></i></button>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-section-title"><i class="fas fa-bell"></i> ALARM CONTROLS</div>
        <button class="btn btn-danger btn-full" onclick="silenceAlarm()"><i class="fas fa-volume-xmark"></i> Silence Alarm</button>
        <button class="btn btn-secondary btn-full" onclick="toggleSiren()"><i class="fas fa-bell" id="sirenIconSide"></i> <span id="sirenTextSide">Siren On</span></button>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-section-title"><i class="fas fa-sliders"></i> THRESHOLD SETTING</div>
        <input type="range" class="slider gas-slider" id="sliderSide" min="5" max="95" value="40">
        <div class="slider-labels">
          <span class="safe">Safe</span>
          <span class="sidebar-value" id="sliderValSide">40%</span>
          <span class="danger">Danger</span>
        </div>
        <button class="btn btn-primary btn-full" onclick="saveThreshold()"><i class="fas fa-save"></i> Save Threshold</button>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-section-title"><i class="fas fa-server"></i> SYSTEM INFO</div>
        <div class="sidebar-info">
          <p><i class="fas fa-wifi"></i> <span id="sidebarStatus">Connecting...</span></p>
          <p><i class="fas fa-microchip"></i> <span id="sidebarHeap">-- KB</span></p>
          <p><i class="fas fa-clock"></i> <span id="sidebarLastUpdate">--</span></p>
        </div>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-section-title"><i class="fas fa-file-pdf"></i> HISTORY ACTIONS</div>
        <button class="btn btn-secondary btn-full" onclick="exportPDF()"><i class="fas fa-download"></i> Download PDF</button>
        <button class="btn btn-danger btn-full" onclick="clearHistory()"><i class="fas fa-trash"></i> Clear History</button>
      </div>
      
      <div class="sidebar-section sidebar-user">
        <div id="userInfo" class="user-info">
          <div class="user-avatar"><i class="fas fa-user"></i></div>
          <div class="user-details">
            <div class="user-name">User</div>
            <div class="user-email"></div>
          </div>
        </div>
        <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
      </div>
    </div>
    
    <div class="connection-banner" id="connectionBanner"><i class="fas fa-wifi-slash"></i> Reconnecting...</div>
    
    <header>
      <div class="header-content">
        <div class="header-left">
          <h1><i class="fas fa-fire-flame-curved"></i> Cloud Fire Alarm</h1>
          <div id="status"><i class="fas fa-spinner fa-spin"></i> Connecting...</div>
        </div>
        <div class="header-center">
          <span id="greetText">Welcome!</span>
        </div>
        <div class="header-right"><div id="currentTime">--:--</div></div>
      </div>
      <div class="tabs">
        <div class="tab active" data-tab="monitor"><i class="fas fa-gauge"></i> <span class="tab-text">Live Monitor</span></div>
        <div class="tab" data-tab="history"><i class="fas fa-clock-rotate-left"></i> <span class="tab-text">History</span></div>
        <div class="tab" data-tab="settings"><i class="fas fa-sliders"></i> <span class="tab-text">Settings</span></div>
        <div style="flex:1"></div>
        <div class="header-actions">
          <button class="action-btn" onclick="toggleFullscreen()" title="Toggle Fullscreen">
            <i class="fas fa-expand" id="fullscreenIcon"></i>
          </button>
          <button class="action-btn" onclick="toggleSidebar()" title="Settings">
            <i class="fas fa-cog"></i>
          </button>
        </div>
      </div>
    </header>

    <main class="container">
      <!-- MONITOR TAB -->
      <div class="tab-content active" id="tab-monitor">
        <div class="card alarm-card" id="alarmCard">
          <div class="alarm-status">
            <i class="fas fa-shield-check" id="alarmIcon"></i>
            <span id="alarmText">System Normal</span>
          </div>
        </div>
        
        <div class="card">
          <div class="card-title"><i class="fas fa-chart-line"></i> Live Sensor Readings</div>
          <div class="sensor-grid">
            <div class="sensor-item">
              <i class="fas fa-fire-flame-simple sensor-icon gas"></i>
              <div class="sensor-bar"><div class="sensor-fill gas" id="gasBar"></div></div>
              <div class="sensor-value" id="gasVal">--</div>
              <div class="sensor-label">Gas %</div>
            </div>
            <div class="sensor-item">
              <i class="fas fa-temperature-half sensor-icon temp"></i>
              <div class="sensor-bar"><div class="sensor-fill temp" id="tempBar"></div></div>
              <div class="sensor-value" id="tempVal">--</div>
              <div class="sensor-label">Temp °C</div>
            </div>
            <div class="sensor-item">
              <i class="fas fa-droplet sensor-icon humidity"></i>
              <div class="sensor-bar"><div class="sensor-fill humidity" id="humBar"></div></div>
              <div class="sensor-value" id="humVal">--</div>
              <div class="sensor-label">Humidity %</div>
            </div>
          </div>
        </div>
        
        <div class="stats-grid">
          <div class="card stat-card">
            <div class="card-title"><i class="fas fa-bolt"></i> Voltage</div>
            <span class="value" id="voltVal">--</span><span class="unit">V</span>
          </div>
          <div class="card stat-card">
            <div class="card-title"><i class="fas fa-fire"></i> Gas Thresh</div>
            <span class="value" id="threshVal">--</span><span class="unit">%</span>
          </div>
          <div class="card stat-card">
            <div class="card-title"><i class="fas fa-thermometer"></i> Temp Thresh</div>
            <span class="value" id="tempThreshVal">--</span><span class="unit">°C</span>
          </div>
          <div class="card stat-card">
            <div class="card-title"><i class="fas fa-triangle-exclamation"></i> Alarms</div>
            <span class="value" id="alarmCount">0</span>
          </div>
          <div class="card stat-card">
            <div class="card-title"><i class="fas fa-satellite-dish"></i> Device</div>
            <span class="value device-status" id="deviceStatus">Offline</span>
          </div>
        </div>
      </div>

      <!-- HISTORY TAB -->
      <div class="tab-content" id="tab-history">
        <div class="card">
          <div class="card-header">
            <div class="card-title"><i class="fas fa-triangle-exclamation"></i> Alarm History (<span id="historyCount">0</span>)</div>
            <span class="badge" id="newBadge"></span>
          </div>
          <div class="history-actions">
            <button class="btn btn-secondary" onclick="exportPDF()"><i class="fas fa-file-pdf"></i> Export PDF</button>
            <button class="btn btn-secondary" onclick="refreshHistory()"><i class="fas fa-refresh"></i> Refresh</button>
            <button class="btn btn-danger" onclick="clearHistory()"><i class="fas fa-trash"></i> Clear All</button>
          </div>
          <div id="historyList" class="history-list">
            <div class="empty-state">
              <i class="fas fa-check-circle"></i>
              <p>No alarm history</p>
            </div>
          </div>
        </div>
      </div>

      <!-- SETTINGS TAB -->
      <div class="tab-content" id="tab-settings">
        <!-- SMS Alerts Section -->
        <div class="card">
          <div class="card-title"><i class="fas fa-sms"></i> Enable SMS Alerts When Alarm Triggers</div>
          <div class="sms-settings">
            <div class="form-group">
              <label>Phone Number (Philippines)</label>
              <input type="tel" id="phoneInput" placeholder="09xxxxxxxxx" class="input-field">
            </div>
            <div class="sms-actions">
              <button class="btn btn-primary" onclick="saveSmsSettings()"><i class="fas fa-save"></i> Save SMS Settings</button>
              <button class="btn btn-secondary" onclick="testSms()"><i class="fas fa-paper-plane"></i> Test SMS</button>
            </div>
            <div class="sms-status" id="smsStatus"></div>
          </div>
        </div>
        
        <!-- Alarm Sound Section -->
        <div class="card">
          <div class="card-title"><i class="fas fa-volume-high"></i> Alarm Sound</div>
          <p class="card-subtitle">Choose the alarm sound that plays when an alert triggers</p>
          <div class="sound-options">
            <label class="sound-option">
              <input type="radio" name="alarmSound" value="911.mp3" checked>
              <span><i class="fas fa-siren"></i> Classic Siren</span>
              <button class="btn-preview" onclick="previewSound('911.mp3')"><i class="fas fa-play"></i> Preview</button>
            </label>
            <label class="sound-option">
              <input type="radio" name="alarmSound" value="Alarm2.mp3">
              <span><i class="fas fa-bell"></i> Buzzer Alert</span>
              <button class="btn-preview" onclick="previewSound('Alarm2.mp3')"><i class="fas fa-play"></i> Preview</button>
            </label>
            <label class="sound-option">
              <input type="radio" name="alarmSound" value="Alarm3.mp3">
              <span><i class="fas fa-fire"></i> Fire Bell</span>
              <button class="btn-preview" onclick="previewSound('Alarm3.mp3')"><i class="fas fa-play"></i> Preview</button>
            </label>
            <label class="sound-option">
              <input type="radio" name="alarmSound" value="Alarm4.mp3">
              <span><i class="fas fa-triangle-exclamation"></i> Urgent Beep</span>
              <button class="btn-preview" onclick="previewSound('Alarm4.mp3')"><i class="fas fa-play"></i> Preview</button>
            </label>
          </div>
          <button class="btn btn-primary" onclick="saveAlarmSound()"><i class="fas fa-save"></i> Save Sound</button>
        </div>
        
        <!-- Gas Threshold Section -->
        <div class="card">
          <div class="card-title"><i class="fas fa-fire-flame-simple"></i> Gas Threshold</div>
          <div class="slider-container">
            <input type="range" class="slider gas-slider" id="thresholdSlider" min="5" max="95" value="40">
            <div class="slider-labels">
              <span class="safe"><i class="fas fa-check-circle"></i> 5%</span>
              <span class="current" id="sliderValue">40%</span>
              <span class="danger"><i class="fas fa-skull-crossbones"></i> 95%</span>
            </div>
          </div>
          <button class="btn btn-primary" onclick="saveThreshold()"><i class="fas fa-save"></i> Save Gas Threshold</button>
        </div>
        
        <!-- Temperature Threshold Section -->
        <div class="card">
          <div class="card-title"><i class="fas fa-temperature-high"></i> Temperature Threshold</div>
          <div class="slider-container">
            <input type="range" class="slider temp-slider" id="tempThresholdSlider" min="40" max="80" value="60">
            <div class="slider-labels">
              <span class="safe"><i class="fas fa-snowflake"></i> 40°C</span>
              <span class="current" id="tempSliderValue">60°C</span>
              <span class="danger"><i class="fas fa-fire"></i> 80°C</span>
            </div>
          </div>
          <button class="btn btn-primary" onclick="saveTempThreshold()"><i class="fas fa-save"></i> Save Temp Threshold</button>
        </div>
        
        <!-- Alarm Controls Section -->
        <div class="card">
          <div class="card-title"><i class="fas fa-bell"></i> Alarm Controls</div>
          <div class="control-buttons">
            <button class="btn btn-danger" onclick="silenceAlarm()"><i class="fas fa-volume-xmark"></i> Silence Alarm</button>
            <button class="btn btn-secondary" onclick="toggleSiren()"><i class="fas fa-bell" id="sirenIcon"></i> <span id="sirenText">Siren On</span></button>
          </div>
        </div>
        
        <!-- Push Notifications Section -->
        <div class="card">
          <div class="card-title"><i class="fas fa-mobile-alt"></i> Push Notifications</div>
          <p class="card-subtitle">Receive browser notifications when alarm triggers</p>
          <button class="btn btn-primary" id="pushBtn" onclick="togglePushNotifications()"><i class="fas fa-bell"></i> Enable Push Notifications</button>
          <div class="push-status" id="pushStatus"></div>
        </div>
        
        <!-- Device Information Section -->
        <div class="card">
          <div class="card-title"><i class="fas fa-server"></i> Device Information</div>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label"><i class="fas fa-microchip"></i> Device ID</span>
              <span class="info-value" id="deviceId">--</span>
            </div>
            <div class="info-item">
              <span class="info-label"><i class="fas fa-clock"></i> Last Update</span>
              <span class="info-value" id="lastUpdate">--</span>
            </div>
            <div class="info-item">
              <span class="info-label"><i class="fas fa-memory"></i> Free Heap</span>
              <span class="info-value" id="freeHeap">--</span>
            </div>
            <div class="info-item">
              <span class="info-label"><i class="fas fa-wifi"></i> Status</span>
              <span class="info-value" id="connectionStatus">--</span>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="js/config.js"></script>
  <script src="js/api.js"></script>
  <script src="js/push.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
