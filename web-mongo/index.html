<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FireWire - Smart Fire Monitoring</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff5722">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <!-- ========== FIRST-TIME SETUP SCREEN ========== -->
  <div id="setupScreen" class="login-screen hidden">
    <div class="login-container setup-container">
      <div class="login-logo"><i class="fas fa-fire-flame-curved"></i></div>
      <h1 class="login-title">Welcome to FireWire</h1>
      <p class="login-subtitle">Let's set up your smart fire monitoring system</p>
      
      <!-- Step Indicator -->
      <div class="setup-steps">
        <div class="step active" id="stepIndicator1"><span>1</span> Verify</div>
        <div class="step" id="stepIndicator2"><span>2</span> Code</div>
        <div class="step" id="stepIndicator3"><span>3</span> Setup</div>
      </div>
      
      <!-- Step 1: Google Sign In -->
      <div id="setupStep1" class="setup-step-content">
        <div class="step-header">
          <i class="fas fa-shield-check"></i>
          <h3>Admin Verification</h3>
        </div>
        <p class="setup-info">Sign in with your Gmail to become the Admin.<br>Only one Admin per household for security.</p>
        <div id="googleSetupBtn" class="google-btn-container"></div>
        <div id="setupError" class="error-message"></div>
      </div>
      
      <!-- Step 2: Verify OTP -->
      <div id="setupStep2" class="hidden setup-step-content">
        <div class="step-header">
          <i class="fas fa-envelope-circle-check"></i>
          <h3>Email Verification</h3>
        </div>
        <p class="setup-info">We sent a 6-digit verification code to<br><strong id="setupEmail"></strong></p>
        <div class="form-group otp-group">
          <input type="password" id="setupOtpInput" placeholder="• • • • • •" maxlength="6" class="otp-input" autocomplete="off">
        </div>
        <button class="btn-signin" onclick="verifySetupOTP()"><i class="fas fa-check-circle"></i> Verify Code</button>
        <div id="otpError" class="error-message"></div>
        <p class="resend-text">Didn't receive the code? <a href="#" onclick="resendSetupOTP(); return false;">Resend Code</a></p>
      </div>
      
      <!-- Step 3: Complete Setup -->
      <div id="setupStep3" class="hidden setup-step-content">
        <div class="step-header">
          <i class="fas fa-sliders"></i>
          <h3>Configure Your System</h3>
        </div>
        <form onsubmit="completeSetup(); return false;" class="setup-form">
          <div class="form-group">
            <label><i class="fas fa-home"></i> Household Name</label>
            <input type="text" id="setupHouseholdName" placeholder="e.g., Dela Cruz Family">
            <small>Give your household a friendly name</small>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label><i class="fas fa-lock"></i> Admin PIN</label>
              <input type="password" id="setupAdminPin" placeholder="••••" maxlength="6" required>
              <small>4-6 digit secret PIN</small>
            </div>
            <div class="form-group">
              <label><i class="fas fa-users"></i> Family Code</label>
              <input type="text" id="setupAccessCode" placeholder="••••••" maxlength="6" required>
              <small>6 digits for family access</small>
            </div>
          </div>
          
          <div class="form-group">
            <label><i class="fas fa-microchip"></i> Device ID</label>
            <input type="text" id="setupDeviceId" placeholder="ESP32_001" value="ESP32_001">
            <small>Your ESP32 device identifier</small>
          </div>
          
          <button type="submit" class="btn-signin btn-success"><i class="fas fa-rocket"></i> Launch My Fire Alarm</button>
        </form>
        <div id="setupCompleteError" class="error-message"></div>
      </div>
    </div>
  </div>

  <!-- ========== ACCESS SCREEN ========== -->
  <div id="accessScreen" class="login-screen hidden">
    <div class="login-container">
      <div class="login-logo"><i class="fas fa-fire-flame-curved"></i></div>
      <h1 class="login-title">FireWire</h1>
      <p class="login-subtitle">Enter your household credentials to access the dashboard</p>
      
      <!-- Access Card -->
      <div class="access-card">
        <!-- Household Access Tab -->
        <div class="access-tabs">
          <button class="access-tab active" onclick="showAccessTab('household')"><i class="fas fa-home"></i> Household</button>
          <button class="access-tab" onclick="showAccessTab('admin')"><i class="fas fa-shield-halved"></i> Admin</button>
        </div>
        
        <!-- Household Access Form -->
        <form id="householdForm" onsubmit="joinHousehold(); return false;">
          <div class="form-group">
            <label><i class="fas fa-id-card"></i> Household ID</label>
            <input type="text" id="householdIdInput" placeholder="Enter 10-digit ID" maxlength="10" required>
          </div>
          <div class="form-group">
            <label><i class="fas fa-key"></i> Access Code</label>
            <div class="input-wrapper">
              <input type="password" id="accessCodeInput" placeholder="Enter 6-digit code" maxlength="6" required>
              <button type="button" class="toggle-password" onclick="togglePassword('accessCodeInput')"><i class="fas fa-eye"></i></button>
            </div>
          </div>
          <div class="form-group">
            <label><i class="fas fa-user"></i> Your Name <span class="optional-tag">(optional)</span></label>
            <input type="text" id="memberNameInput" placeholder="e.g., Mom, Dad, John">
          </div>
          <button type="submit" class="btn-signin"><i class="fas fa-arrow-right"></i> Enter Dashboard</button>
          <div id="householdError" class="error-message"></div>
        </form>
        
        <!-- Admin Login Form -->
        <div id="adminForm" class="hidden">
          <!-- Step 1: Request OTP -->
          <div id="adminStep1">
            <p class="setup-info" style="margin-bottom: 20px;">Admin login requires email verification for security.</p>
            <div class="form-group">
              <label><i class="fas fa-id-card"></i> Household ID</label>
              <input type="text" id="adminHouseholdId" placeholder="Enter 10-digit ID" maxlength="10" required>
            </div>
            <div class="form-group">
              <label><i class="fas fa-envelope"></i> Admin Gmail</label>
              <input type="email" id="adminEmail" placeholder="your.email@gmail.com" required>
            </div>
            <button class="btn-signin" onclick="requestAdminOTP()"><i class="fas fa-paper-plane"></i> Send Verification Code</button>
            <div id="adminError1" class="error-message"></div>
          </div>
          
          <!-- Step 2: Verify OTP + PIN -->
          <div id="adminStep2" class="hidden">
            <!-- Trusted Device Message (shown when OTP is skipped) -->
            <div id="trustedDeviceMsg" class="trusted-device-msg hidden">
              <i class="fas fa-shield-check"></i>
              <p>Welcome back! <span id="trustedDeviceName">This device</span> is trusted.</p>
            </div>
            
            <!-- OTP Input (hidden for trusted devices) -->
            <div id="adminOtpGroup">
              <p class="setup-info">Enter the verification code sent to your Gmail</p>
              <div class="form-group">
                <label><i class="fas fa-hashtag"></i> Verification Code</label>
                <input type="password" id="adminOtpInput" placeholder="Enter 6-digit code" maxlength="6">
              </div>
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-lock"></i> Admin PIN</label>
              <input type="password" id="adminPinInput" placeholder="Enter your PIN" maxlength="6">
            </div>
            
            <!-- Remember Device Checkbox -->
            <div id="rememberDeviceGroup" class="form-group remember-device">
              <label class="checkbox-label">
                <input type="checkbox" id="rememberDeviceCheck">
                <span class="checkmark-box"></span>
                <span>Remember this device for 30 days</span>
              </label>
              <small>Skip verification code on future logins</small>
            </div>
            
            <button class="btn-signin" onclick="adminLogin()"><i class="fas fa-shield-check"></i> Login as Admin</button>
            <button type="button" class="btn-link" onclick="showAdminStep1()"><i class="fas fa-arrow-left"></i> Back</button>
            <div id="adminError2" class="error-message"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MAIN APP ========== -->
  <div id="mainApp" class="main-app hidden">
    <div class="siren-overlay" id="sirenOverlay"></div>
    <div id="audioPrompt" class="audio-prompt">
      <div class="audio-prompt-content">
        <i class="fas fa-volume-up"></i>
        <h2>Enable Alarm Sound</h2>
        <p>Allow audio to hear alarm alerts</p>
        <button class="btn btn-primary" onclick="enableAudio()"><i class="fas fa-check"></i> Enable Sound</button>
      </div>
    </div>
    
    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title"><i class="fas fa-cog"></i> Settings</div>
        <button class="close-btn" onclick="closeSidebar()"><i class="fas fa-times"></i></button>
      </div>
      
      <div class="sidebar-section admin-only">
        <div class="sidebar-section-title"><i class="fas fa-bell"></i> ALARM CONTROLS</div>
        <button class="btn btn-danger btn-full" onclick="silenceAlarm()"><i class="fas fa-volume-xmark"></i> Silence Alarm</button>
        <button class="btn btn-secondary btn-full" onclick="toggleSiren()"><i class="fas fa-bell" id="sirenIconSide"></i> <span id="sirenTextSide">Siren On</span></button>
      </div>
      
      <div class="sidebar-section admin-only">
        <div class="sidebar-section-title"><i class="fas fa-sliders"></i> THRESHOLD</div>
        <input type="range" class="slider gas-slider" id="sliderSide" min="5" max="95" value="40">
        <div class="slider-labels">
          <span class="safe">Safe</span>
          <span class="sidebar-value" id="sliderValSide">40%</span>
          <span class="danger">Danger</span>
        </div>
        <button class="btn btn-primary btn-full" onclick="saveThreshold()"><i class="fas fa-save"></i> Save</button>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-section-title"><i class="fas fa-server"></i> SYSTEM INFO</div>
        <div class="sidebar-info">
          <p><i class="fas fa-wifi"></i> <span id="sidebarStatus">Connecting...</span></p>
          <p><i class="fas fa-microchip"></i> <span id="sidebarHeap">-- KB</span></p>
          <p><i class="fas fa-clock"></i> <span id="sidebarLastUpdate">--</span></p>
        </div>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-section-title"><i class="fas fa-home"></i> HOUSEHOLD</div>
        <div class="sidebar-info">
          <p><i class="fas fa-users"></i> <span id="householdNameDisplay">--</span></p>
          <p><i class="fas fa-user-shield"></i> <span id="accessTypeDisplay">--</span></p>
        </div>
        <button class="btn btn-secondary btn-full" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
      </div>
    </div>
    
    <div class="connection-banner" id="connectionBanner"><i class="fas fa-wifi-slash"></i> Reconnecting...</div>
    
    <header>
      <div class="header-top">
        <div class="header-row-brand">
          <div class="brand">
            <div class="brand-icon"><i class="fas fa-fire-flame-curved"></i></div>
            <div class="brand-text">
              <h1>FireWire</h1>
              <div id="status" class="status-badge"><i class="fas fa-spinner fa-spin"></i> Connecting...</div>
            </div>
          </div>
        </div>
        
        <div class="header-row-info">
          <div class="header-date">
            <span class="date-day" id="currentDay">--</span>
            <span class="date-full" id="currentDate">--</span>
          </div>
          <div class="header-greeting">
            <div class="greeting-card">
              <div class="weather-icon" id="weatherIcon"><i class="fas fa-sun"></i></div>
              <div class="greeting-content">
                <span class="greeting-text" id="greetText">Good Morning!</span>
                <span class="greeting-sub" id="greetSub">--</span>
              </div>
            </div>
          </div>
          <div class="header-time">
            <span class="time-value" id="currentTime">--:--</span>
            <span class="time-period" id="timePeriod">--</span>
          </div>
        </div>
      </div>
      
      <div class="header-nav">
        <div class="tabs">
          <div class="tab active" data-tab="monitor"><i class="fas fa-gauge"></i> <span class="tab-text">Live Monitor</span></div>
          <div class="tab" data-tab="history"><i class="fas fa-clock-rotate-left"></i> <span class="tab-text">History</span></div>
          <div class="tab" data-tab="settings"><i class="fas fa-sliders"></i> <span class="tab-text">Settings</span></div>
        </div>
        <div class="header-actions">
          <button class="action-btn" onclick="toggleFullscreen()" title="Fullscreen"><i class="fas fa-expand" id="fullscreenIcon"></i></button>
          <button class="action-btn settings-btn" onclick="toggleSidebar()" title="Settings"><i class="fas fa-cog"></i></button>
        </div>
      </div>
    </header>

    <main class="container">
      <!-- MONITOR TAB -->
      <div class="tab-content active" id="tab-monitor">
        <div class="alarm-banner" id="alarmCard">
          <div class="alarm-content">
            <div class="alarm-icon-wrap"><i class="fas fa-shield-check" id="alarmIcon"></i></div>
            <div class="alarm-text-wrap">
              <span class="alarm-title" id="alarmText">System Normal</span>
              <span class="alarm-subtitle" id="alarmSubtitle">All sensors within safe range</span>
            </div>
          </div>
          <div class="alarm-pulse"></div>
        </div>
        
        <!-- Fire Risk Banner (hidden by default) -->
        <div class="fire-risk-banner hidden" id="fireRiskBanner">
          <div class="fire-risk-content">
            <i class="fas fa-fire"></i>
            <div class="fire-risk-text">
              <span class="fire-risk-title">FIRE RISK DETECTED</span>
              <span class="fire-risk-subtitle" id="fireRiskTriggers">Multiple sensors triggered</span>
            </div>
          </div>
        </div>

        <!-- Warmup Banner (hidden by default) -->
        <div class="warmup-banner hidden" id="warmupBanner">
          <i class="fas fa-hourglass-half"></i>
          <span>Gas sensors warming up... Readings will be available shortly.</span>
        </div>

        <div class="sensor-panel">
          <div class="sensor-card gas-card">
            <div class="sensor-header"><i class="fas fa-fire-flame-simple"></i><span>Gas Level</span></div>
            <div class="sensor-gauge">
              <div class="gauge-ring">
                <svg viewBox="0 0 100 100">
                  <circle class="gauge-bg" cx="50" cy="50" r="42"/>
                  <circle class="gauge-fill gas-gauge" id="gasGauge" cx="50" cy="50" r="42"/>
                </svg>
                <div class="gauge-value"><span class="gauge-number" id="gasVal">--</span><span class="gauge-unit">%</span></div>
              </div>
            </div>
            <div class="sensor-status"><span class="status-label">Threshold:</span><span class="status-value" id="threshVal">40</span>%</div>
          </div>
          
          <!-- CO Sensor Card -->
          <div class="sensor-card co-card">
            <div class="sensor-header">
              <i class="fas fa-skull-crossbones"></i><span>Carbon Monoxide</span>
              <span class="sensor-health-icon hidden" id="coHealthIcon" title="Sensor issue detected"><i class="fas fa-exclamation-triangle"></i></span>
            </div>
            <div class="sensor-gauge">
              <div class="gauge-ring">
                <svg viewBox="0 0 100 100">
                  <circle class="gauge-bg" cx="50" cy="50" r="42"/>
                  <circle class="gauge-fill co-gauge" id="coGauge" cx="50" cy="50" r="42"/>
                </svg>
                <div class="gauge-value"><span class="gauge-number" id="coVal">--</span><span class="gauge-unit">PPM</span></div>
              </div>
            </div>
            <div class="sensor-status"><span class="status-label">Status:</span><span class="status-value" id="coStatus">--</span></div>
          </div>
          
          <!-- AQI Sensor Card -->
          <div class="sensor-card aqi-card">
            <div class="sensor-header">
              <i class="fas fa-wind"></i><span>Air Quality</span>
              <span class="sensor-health-icon hidden" id="aqiHealthIcon" title="Sensor issue detected"><i class="fas fa-exclamation-triangle"></i></span>
            </div>
            <div class="sensor-gauge">
              <div class="gauge-ring">
                <svg viewBox="0 0 100 100">
                  <circle class="gauge-bg" cx="50" cy="50" r="42"/>
                  <circle class="gauge-fill aqi-gauge" id="aqiGauge" cx="50" cy="50" r="42"/>
                </svg>
                <div class="gauge-value"><span class="gauge-number" id="aqiVal">--</span><span class="gauge-unit">AQI</span></div>
              </div>
            </div>
            <div class="sensor-status"><span class="status-label">Level:</span><span class="status-value" id="aqiStatus">--</span></div>
          </div>
          
          <div class="sensor-card temp-card">
            <div class="sensor-header"><i class="fas fa-temperature-half"></i><span>Temperature</span></div>
            <div class="sensor-gauge">
              <div class="gauge-ring">
                <svg viewBox="0 0 100 100">
                  <circle class="gauge-bg" cx="50" cy="50" r="42"/>
                  <circle class="gauge-fill temp-gauge" id="tempGauge" cx="50" cy="50" r="42"/>
                </svg>
                <div class="gauge-value"><span class="gauge-number" id="tempVal">--</span><span class="gauge-unit">°C</span></div>
              </div>
            </div>
            <div class="sensor-status"><span class="status-label">Threshold:</span><span class="status-value" id="tempThreshVal">60</span>°C</div>
          </div>
          
          <div class="sensor-card humidity-card">
            <div class="sensor-header"><i class="fas fa-droplet"></i><span>Humidity</span></div>
            <div class="sensor-gauge">
              <div class="gauge-ring">
                <svg viewBox="0 0 100 100">
                  <circle class="gauge-bg" cx="50" cy="50" r="42"/>
                  <circle class="gauge-fill humidity-gauge" id="humGauge" cx="50" cy="50" r="42"/>
                </svg>
                <div class="gauge-value"><span class="gauge-number" id="humVal">--</span><span class="gauge-unit">%</span></div>
              </div>
            </div>
            <div class="sensor-status"><span class="status-label">Level:</span><span class="status-value" id="humLevel">Normal</span></div>
          </div>
        </div>
        
        <div class="quick-stats">
          <div class="quick-stat">
            <div class="stat-icon voltage"><i class="fas fa-bolt"></i></div>
            <div class="stat-info"><span class="stat-value"><span id="voltVal">--</span><small>V</small></span><span class="stat-label">Voltage</span></div>
          </div>
          <div class="quick-stat">
            <div class="stat-icon alarms"><i class="fas fa-triangle-exclamation"></i></div>
            <div class="stat-info"><span class="stat-value" id="alarmCount">0</span><span class="stat-label">Total Alarms</span></div>
          </div>
          <div class="quick-stat">
            <div class="stat-icon device"><i class="fas fa-satellite-dish"></i></div>
            <div class="stat-info"><span class="stat-value device-status" id="deviceStatus">Offline</span><span class="stat-label">Device Status</span></div>
          </div>
          <div class="quick-stat">
            <div class="stat-icon uptime"><i class="fas fa-clock"></i></div>
            <div class="stat-info"><span class="stat-value" id="lastSeen">--</span><span class="stat-label">Last Update</span></div>
          </div>
        </div>
      </div>

      <!-- HISTORY TAB -->
      <div class="tab-content" id="tab-history">
        <div class="card">
          <div class="card-header">
            <div class="card-title"><i class="fas fa-triangle-exclamation"></i> Alarm History (<span id="historyCount">0</span>)</div>
          </div>
          <div class="history-actions">
            <button class="btn btn-secondary" onclick="exportPDF()"><i class="fas fa-file-pdf"></i> Export PDF</button>
            <button class="btn btn-secondary" onclick="refreshHistory()"><i class="fas fa-refresh"></i> Refresh</button>
            <button class="btn btn-danger admin-only" onclick="clearHistory()"><i class="fas fa-trash"></i> Clear All</button>
          </div>
          <div id="historyList" class="history-list">
            <div class="empty-state"><i class="fas fa-check-circle"></i><p>No alarm history</p></div>
          </div>
        </div>
      </div>

      <!-- SETTINGS TAB -->
      <div class="tab-content" id="tab-settings">
        <!-- Alarm Sound (Personal) -->
        <div class="card">
          <div class="card-title"><i class="fas fa-volume-high"></i> Alarm Sound</div>
          <p class="card-subtitle">Your personal alarm sound preference</p>
          <div class="sound-options">
            <label class="sound-option">
              <input type="radio" name="alarmSound" value="911.mp3" checked>
              <span><i class="fas fa-siren"></i> Classic Siren</span>
              <button class="btn-preview" onclick="previewSound('911.mp3')"><i class="fas fa-play"></i></button>
            </label>
            <label class="sound-option">
              <input type="radio" name="alarmSound" value="Alarm2.mp3">
              <span><i class="fas fa-bell"></i> Buzzer Alert</span>
              <button class="btn-preview" onclick="previewSound('Alarm2.mp3')"><i class="fas fa-play"></i></button>
            </label>
            <label class="sound-option">
              <input type="radio" name="alarmSound" value="Alarm3.mp3">
              <span><i class="fas fa-fire"></i> Fire Bell</span>
              <button class="btn-preview" onclick="previewSound('Alarm3.mp3')"><i class="fas fa-play"></i></button>
            </label>
          </div>
          <button class="btn btn-primary" onclick="saveAlarmSound()"><i class="fas fa-save"></i> Save Sound</button>
        </div>
        
        <!-- Admin-Only Settings -->
        <div class="admin-only">
          <div class="card">
            <div class="card-title"><i class="fas fa-fire-flame-simple"></i> Gas Threshold</div>
            <div class="slider-container">
              <input type="range" class="slider gas-slider" id="thresholdSlider" min="5" max="95" value="40">
              <div class="slider-labels">
                <span class="safe">5%</span>
                <span class="current" id="sliderValue">40%</span>
                <span class="danger">95%</span>
              </div>
            </div>
            <button class="btn btn-primary" onclick="saveThreshold()"><i class="fas fa-save"></i> Save Threshold</button>
          </div>
          
          <div class="card">
            <div class="card-title"><i class="fas fa-temperature-high"></i> Temperature Threshold</div>
            <div class="slider-container">
              <input type="range" class="slider temp-slider" id="tempThresholdSlider" min="40" max="80" value="60">
              <div class="slider-labels">
                <span class="safe">40°C</span>
                <span class="current" id="tempSliderValue">60°C</span>
                <span class="danger">80°C</span>
              </div>
            </div>
            <button class="btn btn-primary" onclick="saveTempThreshold()"><i class="fas fa-save"></i> Save Threshold</button>
          </div>
          
          <!-- CO Thresholds -->
          <div class="card">
            <div class="card-title"><i class="fas fa-skull-crossbones"></i> CO Thresholds (PPM)</div>
            <div class="threshold-group">
              <label>Warning Level</label>
              <input type="range" class="slider" id="coWarningSlider" min="10" max="50" value="35">
              <span id="coWarningVal">35 PPM</span>
            </div>
            <div class="threshold-group">
              <label>Danger Level</label>
              <input type="range" class="slider" id="coDangerSlider" min="50" max="200" value="100">
              <span id="coDangerVal">100 PPM</span>
            </div>
            <div class="threshold-group">
              <label>Critical Level</label>
              <input type="range" class="slider" id="coCriticalSlider" min="200" max="800" value="400">
              <span id="coCriticalVal">400 PPM</span>
            </div>
            <button class="btn btn-primary" onclick="saveCOThresholds()"><i class="fas fa-save"></i> Save CO Thresholds</button>
          </div>
          
          <!-- Sensor Calibration -->
          <div class="card">
            <div class="card-title"><i class="fas fa-sliders"></i> Sensor Calibration</div>
            <div class="calibration-info">
              <p><span>Last Calibration</span><span id="lastCalibration">Never</span></p>
              <p><span>CO Sensor (Ro)</span><span id="coRoValue">10000 Ω</span></p>
              <p><span>AQI Sensor (Ro)</span><span id="aqiRoValue">10000 Ω</span></p>
            </div>
            <p class="card-subtitle">Ensure sensors are in clean air before calibrating</p>
            <button class="btn btn-secondary" onclick="startCalibration()"><i class="fas fa-sync"></i> Calibrate Sensors</button>
          </div>
          
          <div class="card">
            <div class="card-title"><i class="fas fa-bell"></i> Alarm Controls</div>
            <div class="control-buttons">
              <button class="btn btn-danger" onclick="silenceAlarm()"><i class="fas fa-volume-xmark"></i> Silence Alarm</button>
              <button class="btn btn-secondary" onclick="toggleSiren()"><i class="fas fa-bell" id="sirenIcon"></i> <span id="sirenText">Siren On</span></button>
            </div>
          </div>
        </div>
        
        <!-- Push Notifications -->
        <div class="card">
          <div class="card-title"><i class="fas fa-mobile-alt"></i> Push Notifications</div>
          <p class="card-subtitle">Receive alerts when alarm triggers</p>
          <button class="btn btn-primary" id="pushBtn" onclick="togglePushNotifications()"><i class="fas fa-bell"></i> Enable Notifications</button>
          <div class="push-status" id="pushStatus"></div>
        </div>
        
        <!-- Device Info -->
        <div class="card">
          <div class="card-title"><i class="fas fa-server"></i> Device Information</div>
          <div class="info-grid">
            <div class="info-item"><span class="info-label"><i class="fas fa-microchip"></i> Device ID</span><span class="info-value" id="deviceId">--</span></div>
            <div class="info-item"><span class="info-label"><i class="fas fa-clock"></i> Last Update</span><span class="info-value" id="lastUpdate">--</span></div>
            <div class="info-item"><span class="info-label"><i class="fas fa-memory"></i> Free Heap</span><span class="info-value" id="freeHeap">--</span></div>
            <div class="info-item"><span class="info-label"><i class="fas fa-wifi"></i> Status</span><span class="info-value" id="connectionStatus">--</span></div>
          </div>
        </div>
        
        <!-- Factory Reset (Admin Only) -->
        <div class="admin-only">
          <div class="card card-danger">
            <div class="card-title"><i class="fas fa-triangle-exclamation"></i> Danger Zone</div>
            <p class="card-subtitle">Irreversible actions that affect all users</p>
            <button class="btn btn-danger" onclick="showFactoryResetModal()">
              <i class="fas fa-trash-can"></i> Factory Reset
            </button>
          </div>
        </div>
      </div>
    </main>
    
    <!-- Factory Reset Modal -->
    <div id="factoryResetModal" class="modal hidden">
      <div class="modal-overlay" onclick="hideFactoryResetModal()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <i class="fas fa-exclamation-triangle modal-icon-danger"></i>
          <h3>Factory Reset</h3>
        </div>
        <div class="modal-body">
          <p class="modal-warning">This will permanently delete:</p>
          <ul class="reset-list">
            <li><i class="fas fa-users"></i> All household members</li>
            <li><i class="fas fa-microchip"></i> All registered devices</li>
            <li><i class="fas fa-history"></i> All alarm history</li>
            <li><i class="fas fa-cog"></i> All settings and configurations</li>
          </ul>
          <p class="modal-warning">Everyone will be logged out and you'll need to set up again.</p>
          
          <div class="form-group">
            <label><i class="fas fa-lock"></i> Enter Admin PIN</label>
            <input type="password" id="resetPinInput" placeholder="Your PIN" maxlength="6">
          </div>
          <div class="form-group">
            <label><i class="fas fa-keyboard"></i> Type RESET to confirm</label>
            <input type="text" id="resetConfirmInput" placeholder="Type RESET" autocomplete="off">
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="hideFactoryResetModal()">Cancel</button>
          <button class="btn btn-danger" onclick="performFactoryReset()">
            <i class="fas fa-trash-can"></i> Reset Everything
          </button>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <footer class="app-footer">
      <div class="footer-content">
        <div class="footer-brand">
          <i class="fas fa-fire-flame-curved"></i>
          <span>FireWire</span>
        </div>
        <div class="footer-info">
          <p>Smart IoT Fire Monitoring System</p>
          <p>Real-time gas, temperature & air quality detection with instant alerts</p>
        </div>
        <div class="footer-credits">
          <p>Designed & Developed by <strong>Vince Angelo Nailon</strong></p>
          <p class="footer-tech"><i class="fas fa-microchip"></i> ESP32 + Node.js + MongoDB</p>
        </div>
        <div class="footer-bottom">
          <span>&copy; 2025 FireWire. All rights reserved.</span>
        </div>
      </div>
    </footer>
  </div>

  <script src="js/config.js"></script>
  <script src="js/api.js"></script>
  <script src="js/push.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
